<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KASLIVE | Successor Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <link rel="icon" href="https://cryptologos.cc/logos/kaspa-kas-logo.png" type="image/png">
</head>
<body>
    <header>
        <div class="alert-shutdown">
            ‚ö†Ô∏è Successor Dashboard: Built for Community Continuity üõ†Ô∏è
        </div>
        <div class="header-content">
            <div class="logo">KASLIVE <span style="font-size:0.6em; color:#666; font-weight:normal;">(Beta)</span></div>
            <nav>
                <a href="#stats">Network</a>
                <a href="#l2">KRC-20 Tokens</a>
                <a href="#whales">Whale Watch</a>
                <a href="#market">Market</a>
            </nav>
        </div>
    </header>

    <main class="dashboard-grid">
        
        <section id="market" class="card market-stats-card">
            <h2>KAS Market Stats</h2>
            <div class="stat-group">
                <div class="stat-item">
                    <p class="stat-label">Price (USD)</p>
                    <p id="kas-price" class="stat-value">--</p>
                    <p id="price-change" class="stat-detail">--</p>
                </div>
                <div class="stat-item">
                    <p class="stat-label">Volume (24h)</p>
                    <p id="kas-volume" class="stat-value">--</p>
                </div>
                <div class="stat-item">
                    <p class="stat-label">Market Cap</p>
                    <p id="kas-mcap" class="stat-value">--</p>
                </div>
                <div class="stat-item">
                    <p class="stat-label">Ranking</p>
                    <p id="kas-rank" class="stat-value">--</p>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="priceChart"></canvas>
            </div>
        </section>

        <section id="stats" class="network-metrics-grid">
            <div class="card metric-box">
                <p class="metric-label">DAA Score</p>
                <p id="daa-score" class="metric-value">--</p>
            </div>
            <div class="card metric-box">
                <p class="metric-label">Current Supply</p>
                <p id="current-supply" class="metric-value">--</p>
            </div>
            <div class="card metric-box">
                <p class="metric-label">Real-Time TPS</p>
                <p id="real-time-tps" class="metric-value">--</p>
            </div>
            <div class="card metric-box">
                <p class="metric-label">Real-Time BPS</p>
                <p id="real-time-bps" class="metric-value">--</p>
            </div>
            
            <div class="card metric-box large">
                <p class="metric-label">Hashrate</p>
                <p id="hashrate" class="metric-value">--</p>
                <p class="stat-detail">Network Security</p>
            </div>
            <div class="card metric-box">
                <p class="metric-label">Mined %</p>
                <p id="mined-percent" class="metric-value">--</p>
            </div>
            <div class="card metric-box" id="emissions">
                <p class="metric-label">Next Reduction</p>
                <p id="next-reduction-days" class="metric-value">--</p>
                <p class="stat-detail">days</p>
            </div>
            <div class="card metric-box">
                <p class="metric-label">Max TPS (10s)</p>
                <p id="max-tps-10s" class="metric-value">--</p>
            </div>
        </section>

        <section id="l2" class="card full-width">
            <div class="section-header">
                <h2>üíé KRC-20 Ecosystem Tracker</h2>
                <span class="live-badge">‚óè Live Data</span>
            </div>
            
            <div class="l2-summary">
                <div class="l2-summary-item">Total Cap: <span id="total-tvl">--</span></div>
                <div class="l2-summary-item">24h Vol: <span id="total-volume-24h">--</span></div>
                <div class="l2-summary-item">Tokens Tracked: <span id="total-projects">--</span></div>
            </div>
            
            <div class="table-container">
                <table id="l2-projects-table">
                    <thead>
                        <tr>
                            <th>Token</th>
                            <th>Market Cap (TVL)</th>
                            <th>Volume (24h)</th>
                            <th>24h Change</th>
                            <th>Network</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </div>
        </section>

        <section id="whales" class="card full-width">
            <div class="section-header">
                <h2>üê≥ Whale Watch (Top 50)</h2>
                <p class="section-subtitle">Tracking the largest wallets on the Kaspa network.</p>
            </div>
            
            <div class="table-container">
                <table id="whale-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Address</th>
                            <th>Known Tag</th>
                            <th>Balance (KAS)</th>
                            <th>Explorer</th>
                        </tr>
                    </thead>
                    <tbody>
                        </tbody>
                </table>
            </div>
        </section>

    </main>

    <footer>
        <p>Built for the Community ‚Ä¢ Powered by Open Source ‚Ä¢ <a href="https://github.com/dnilgis/kaspai" target="_blank">View on GitHub</a></p>
    </footer>

    <script>
        // formatting helper
        const formatNumber = (num, currency = true) => {
            if (typeof num === 'string') return num; 
            if (num >= 1000000000) return (num / 1000000000).toFixed(2) + ' B';
            if (num >= 1000000) return (num / 1000000).toFixed(2) + ' M';
            if (num >= 1000) return num.toLocaleString();
            return currency ? '$' + num.toFixed(2) : num.toFixed(2);
        };

        const loadData = async (fileName) => {
            try {
                // cache-busting timestamp
                const response = await fetch(`data/${fileName}?t=${new Date().getTime()}`);
                if (!response.ok) throw new Error(`Failed to load ${fileName}`);
                return response.json();
            } catch (error) {
                console.warn(error); // Warn instead of Error to keep console clean
                return {};
            }
        };

        const updateDashboard = async () => {
            const marketData = await loadData('market_data.json');
            const networkData = await loadData('network_data.json');
            const l2Data = await loadData('l2_data.json');
            const whaleData = await loadData('whale_data.json');

            // 1. UPDATE MARKET
            if (marketData.price_usd) {
                document.getElementById('kas-price').textContent = `$${marketData.price_usd.toFixed(4)}`;
                document.getElementById('kas-volume').textContent = formatNumber(marketData.volume_24h, false);
                document.getElementById('kas-mcap').textContent = formatNumber(marketData.market_cap, false);
                document.getElementById('kas-rank').textContent = `#${marketData.ranking}`;
                
                const changeElement = document.getElementById('price-change');
                changeElement.textContent = `${marketData.price_change_24h}%`;
                changeElement.className = marketData.price_change_24h >= 0 ? 'stat-detail up' : 'stat-detail down';
            }

            // 2. UPDATE NETWORK
            document.getElementById('daa-score').textContent = networkData.daa_score || '--';
            document.getElementById('current-supply').textContent = networkData.current_supply || '--';
            document.getElementById('real-time-tps').textContent = networkData.real_time_tps || '--';
            document.getElementById('real-time-bps').textContent = networkData.real_time_bps || '--';
            document.getElementById('hashrate').textContent = networkData.hashrate || '--';
            document.getElementById('mined-percent').textContent = `${networkData.mined_percent}%` || '--';
            document.getElementById('next-reduction-days').textContent = networkData.next_reduction_days || '--';
            document.getElementById('max-tps-10s').textContent = networkData.max_tps_10s || '--';
            
            // 3. UPDATE KRC-20 LIST
            if (l2Data.projects) {
                document.getElementById('total-tvl').textContent = l2Data.total_tvl; // Already formatted in Python
                document.getElementById('total-volume-24h').textContent = l2Data.total_volume_24h;
                document.getElementById('total-projects').textContent = l2Data.total_projects;

                const tableBody = document.querySelector('#l2-projects-table tbody');
                tableBody.innerHTML = ''; 
                l2Data.projects.forEach(p => {
                    const row = tableBody.insertRow();
                    
                    // Token Name & Symbol
                    row.insertCell().innerHTML = `<strong>${p.name}</strong> <span style="font-size:0.8em; color:#666;">(${p.symbol || ''})</span>`;
                    
                    row.insertCell().textContent = formatNumber(p.tvl);
                    row.insertCell().textContent = formatNumber(p.volume_24h);
                    
                    // Change
                    const changeCell = row.insertCell();
                    if (p.change_24h !== undefined) {
                        changeCell.textContent = `${p.change_24h.toFixed(2)}%`;
                        changeCell.className = p.change_24h >= 0 ? 'stat-detail up' : 'stat-detail down';
                    } else {
                        changeCell.textContent = '--';
                    }
                    
                    row.insertCell().textContent = p.network;
                    
                    // Action Button
                    const actionCell = row.insertCell();
                    const link = document.createElement('a');
                    link.href = p.visit;
                    link.innerHTML = 'View';
                    link.className = 'btn-small';
                    link.target = '_blank';
                    actionCell.appendChild(link);
                });
            }

            // 4. UPDATE WHALE LIST
            if (whaleData.whales) {
                const whaleBody = document.querySelector('#whale-table tbody');
                whaleBody.innerHTML = '';
                
                whaleData.whales.forEach(w => {
                    const row = whaleBody.insertRow();
                    
                    // Rank
                    const rankCell = row.insertCell();
                    rankCell.textContent = `#${w.rank}`;
                    rankCell.style.fontWeight = 'bold';
                    
                    // Address
                    const addrCell = row.insertCell();
                    addrCell.innerHTML = `<span class="addr-text">${w.address}</span>`;
                    
                    // Tag
                    const tagCell = row.insertCell();
                    if (w.name !== "Unknown Whale") {
                        tagCell.innerHTML = `<span class="tag-whale">${w.name}</span>`;
                    } else {
                        tagCell.innerHTML = `<span style="color:#ccc;">-</span>`;
                    }
                    
                    // Balance
                    const balCell = row.insertCell();
                    balCell.textContent = formatNumber(w.balance, false);
                    balCell.style.fontWeight = 'bold';
                    
                    // Link
                    const linkCell = row.insertCell();
                    const link = document.createElement('a');
                    link.href = w.link;
                    link.textContent = " Explorer ‚Üó";
                    link.className = "action-link";
                    link.target = "_blank";
                    linkCell.appendChild(link);
                });
            }
        };

        // Static Price Chart (Placeholder for visual appeal)
        const drawChart = () => {
            const ctx = document.getElementById('priceChart').getContext('2d');
            
            // Create Gradient
            let gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(0, 204, 204, 0.2)');
            gradient.addColorStop(1, 'rgba(0, 204, 204, 0.0)');

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['4D', '3D', '2D', '1D', 'Now'],
                    datasets: [{
                        label: 'Price',
                        data: [0.046, 0.048, 0.047, 0.050, 0.0476], 
                        borderColor: '#00CCCC',
                        backgroundColor: gradient,
                        borderWidth: 2,
                        tension: 0.4,
                        pointRadius: 0,
                        fill: true,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { x: { display: false }, y: { display: false } }
                }
            });
        };

        window.onload = () => {
            updateDashboard();
            drawChart();
            // Auto-refresh data every 5 minutes
            setInterval(updateDashboard, 300000); 
        };
    </script>
</body>
</html>
